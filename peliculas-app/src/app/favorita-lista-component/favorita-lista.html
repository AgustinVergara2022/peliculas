<div class="container mt-3" *ngIf="mensaje">
  <div class="alert alert-warning alert-dismissible fade show text-center" role="alert">
    {{ mensaje }}
  </div>
</div>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <label class="me-2 fw-bold">Filtrar por año:</label>
    <input type="number" class="form-control d-inline-block w-auto me-2" #anioFiltro>
    <button class="btn btn-outline-primary btn-sm" (click)="filtrarPorAnio(anioFiltro.valueAsNumber)">Filtrar</button>
  </div>

  <div>
    <label class="me-2 fw-bold">Ordenar por:</label>
    <select #ordenSelect class="form-select d-inline-block w-auto" (change)="ordenarPor(ordenSelect.value)">
      <option value="">Seleccionar</option>
      <option value="titulo">Título</option>
      <option value="anio">Año</option>
    </select>
  </div>
</div>
  <div class="row">
    <div class="col-md-4 mb-4" *ngFor="let favorita of favoritas">
      <div class="card bg-dark text-light shadow-sm border-secondary h-100">
        <div class="card-body">
          <h5 class="card-title text-warning mb-3">{{ favorita.titulo }}</h5>
          
          <p class="text-secondary mb-3">({{ favorita.anio || 'Año desconocido' }})</p>
            <img 
          [src]="favorita.poster || 'assets/no-image.png'" 
          class="card-img-top img-fluid rounded-top"
          alt="Poster de {{ favorita.titulo }}"
          style="object-fit: cover; height: 400px;">
          
          <div class="mb-3">
            <label class="form-label fw-bold">Puntuación:</label>
            <div>
              <span 
                *ngFor="let star of [1,2,3,4,5]" 
                class="fs-4 me-1"
                [class.text-warning]="star <= favorita.puntuacion"
                [class.text-secondary]="star > favorita.puntuacion"
                (click)="setPuntuacion(favorita, star)"
                style="cursor: pointer;">
                ★
              </span>
              <span class="ms-2 fw-semibold">{{ favorita.puntuacion || 0 }}/5</span>
            </div>
          </div>

          
          <div class="mb-3">
            <label class="form-label fw-bold">Comentario:</label>
            <textarea 
              [(ngModel)]="favorita.comentario"
              class="form-control bg-dark text-light border-secondary"
              rows="2"
              maxlength="200"
              placeholder="Escribe tu opinión..."></textarea>
          </div>

         
          <div class="d-flex justify-content-between">
            <button 
              class="btn btn-outline-success btn-sm"
              [disabled]="!favorita.puntuacion"
              (click)="guardarComentarioYPuntuacion(favorita)">
              Guardar
            </button>

            <button 
              class="btn btn-outline-warning btn-sm"
              (click)="eliminar(favorita.id)">
              Eliminar
            </button>
          </div>
        </div>


        <div class="card-footer text-muted text-end small">
          {{ favorita.fechaGuardado | date:'short' }}
        </div>
      </div>
    </div>
  </div>
</div>
